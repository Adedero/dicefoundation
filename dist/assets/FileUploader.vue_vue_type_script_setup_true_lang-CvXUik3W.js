import{d as N,r as w,i as V,aV as M,b as f,M as U,c as x,a as r,aD as I,j as b,w as z,p as L,t as v,s as $,H as F,o as c}from"./index-WTmT20yY.js";import{s as j}from"./ErrorMessage.vue_vue_type_script_setup_true_lang-B43nygGB.js";const D={class:"flex flex-col items-center justify-center *:flex-shrink-0"},E=["for"],A={key:0,class:"pi pi-spinner animate-spin"},P={key:1,class:"pi pi-upload"},R={key:1,class:"grid grid-cols-2 gap-2 w-full"},G=["id","accept","multiple"],O=N({__name:"FileUploader",props:{accept:{},invalidFileSizeMessage:{},invalidFileTypeMessage:{},maxFileSize:{},maxFileNumber:{},buttonType:{default:"primary"},chooseLabel:{default:"Choose"},uploadLabel:{default:"Upload"},multiple:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},inputId:{default:"v-file-uploader"},disabled:{type:Boolean,default:!1},size:{}},emits:["cancel","select","upload"],setup(i,{emit:B}){const g=B,l=w(null),s=w({}),S=async e=>{s.value={};const o=e.target,n=o==null?void 0:o.files;if(!n){s.value={error:!0,message:"No files selected."};return}if(l.value=Array.from(n),i.maxFileNumber){const a=parseInt(i.maxFileNumber.toString(),10);if(l.value.length>a){l.value=null,s.value={error:!0,message:`Only ${a} files can be uploaded.`};return}}if(i.accept&&!l.value.every(t=>{var p,m,d;const u=t.type,h=(d=(m=(p=t==null?void 0:t.name)==null?void 0:p.split("."))==null?void 0:m.pop())==null?void 0:d.toLowerCase();return u.match(i.accept)||i.accept.includes(h??"")})){l.value=null,s.value={error:!0,message:i.invalidFileTypeMessage||"File format is not allowed."};return}if(i.maxFileSize){const a=T(i.maxFileSize);if(!l.value.every(u=>u.size<=i.maxFileSize)){l.value=null,s.value={error:!0,message:i.invalidFileSizeMessage||`File size exceeds the ${a} limit.`};return}}s.value={error:!1,message:""};for await(const a of l.value){const t=new FileReader,u=await new Promise((h,p)=>{t.readAsDataURL(a),t.onload=m=>{var d;h((d=m.target)==null?void 0:d.result)},t.onerror=()=>{p(new Error("File reading failed"))}});a.dataUrl=u}g("select",l.value)},k=()=>{if(l.value){const e=l.value;g("upload",e),l.value=null}},y=()=>{l.value=null,s.value={error:!1,message:""},g("cancel")},C=V(()=>l.value?l.value.length>1?`${l.value.length} files selected`:l.value[0].name:"No files selected");function T(e){const o=["Bytes","KB","MB","GB","TB","PB"];let n=0,a=e;for(;a>=1024&&n<o.length-1;)a/=1024,n++;return`${a.toFixed(1)} ${o[n]}`}return M(()=>{y()}),(e,o)=>{const n=j,a=$;return c(),f("div",D,[U(b(n,{severity:"error",closable:"",class:"w-full mb-2"},{default:z(()=>[L(v(s.value.message),1)]),_:1},512),[[I,s.value.error]]),l.value?(c(),f("div",R,[b(a,{onClick:y,size:e.size,severity:"secondary",label:"Cancel",icon:"pi pi-times-circle"},null,8,["size"]),b(a,{onClick:k,icon:"pi pi-upload",severity:e.buttonType,style:{padding:"0",width:"100%"},loading:e.loading,disabled:e.loading||e.disabled,size:e.size},{default:z(()=>[r("div",{class:F(["font-semibold flex items-center justify-center gap-2 cursor-pointer w-full p-2",{"cursor-context-menu":e.disabled,"!p-1":e.size==="small"}])},[r("span",{class:F(e.loading?"pi pi-spinner pi-spin":"pi pi-plus")},null,2),r("span",null,v(e.uploadLabel),1)],2)]),_:1},8,["severity","loading","disabled","size"])])):(c(),x(a,{key:0,icon:"pi pi-upload",severity:e.buttonType,fluid:"",style:{padding:"0",width:"100%"},disabled:e.loading,size:e.size},{default:z(()=>[r("label",{for:e.inputId,class:"font-semibold flex items-center justify-center gap-2 cursor-pointer w-full p-2"},[e.loading?(c(),f("span",A)):(c(),f("span",P)),r("span",null,v(e.chooseLabel),1)],8,E)]),_:1},8,["severity","disabled","size"])),r("p",{class:F([{"text-slate-500":!l.value},"mt-2 max-w-60 text-center font-medium font-600 text-sm truncate"])},v(C.value),3),r("input",{id:e.inputId,onInput:S,onCancel:y,type:"file",accept:e.accept,multiple:e.multiple,class:"hidden"},null,40,G)])}}});export{O as _};
